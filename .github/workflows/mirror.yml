name: Mirror Sync Final Fix
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  mirror-force:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false  # <--- THIS IS THE FIX. It kicks the robot out.

      - name: Push to Destination
        env:
          TARGET_TOKEN: ${{ secrets.DESTINATION_PAT }}
          TARGET_USER: harshgoel2004work
          TARGET_REPO: harshgoel2004work/twj-labs
        run: |
          # We construct the URL manually. 
          # Because persist-credentials is false, Git MUST use this token.
          git push https://$TARGET_USER:$TARGET_TOKEN@github.com/$TARGET_REPO.git main --force